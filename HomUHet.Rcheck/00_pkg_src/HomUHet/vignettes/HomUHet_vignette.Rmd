---
title: "HomUHet Vignette"
output: rmarkdown::pdf_document
vignette: >
  %\VignetteIndexEntry{HomUHet Vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}

```
**Type** Package

**Title** Identifying and Separating Homogeneous and Heterogeneous Predictors

**Version**: 0.0.0.9000

**Date**: 2020-01-22

**Depends** tidyverse, glmnet, HDeconometrics, gglasso

**Suggests** knitr, rmarkdown

**Description** This package contains functions to identify and separate predictors with homogeneous or heterogeneous effects across ultra high-dimensional datasets.

**VignetteBuilder** knitr

**Encoding** UTF-8

**RoxygenNote** 7.1.1

**Author** Pei S. Yang [aut, cre]

**Maintainer** Pei S. Yang \<yang.1736@osu.edu\>

**Repository** Git Hub

# 1.1 Introduction

The presence of biological homogeneity and heterogeneity is a phenomenon that many researchers seek to understand. Often times, researchers want to identify biomarkers having heterogeneous or homogeneous effects on an outcome. HomUHet defines a biomarker as having a homogeneous effect if its effects are an non-zero constant across studies, and heterogeneous if the effects are not all equal. However, identifying the biological heterogeneity and homogeneity in the effects of predictors across data sets while maintaining computational efficiency and accounting for dependency structure within correlated data is challenging and urgently needed. 

HomUHet is developed to address the problem by using individual level data to fit penalized linear regression models. Since HomUHet is using a two step procedure, it requires special standardization where each predictor needs to be standardized within each study prior to applying HomUHet and future work will be done for cases (e.g. the study-specific sample variances of a predictor are not assumed to be constant across studies) where this standardization may not apply. 

In this package, we provide the following functions

* HomUHet fits penalized linear regression models in two steps and performs variable selection, which provides the names of identified predictors with homogeneous or heterogeneous effects, as well as their estimated coefficients.

* HomUHet.sim simulate multiple data sets with correlated predictors, homogeneous and heterogeneous effects of predictors and generate the response variable.

* HomUHet.sim.beta simulate the coefficient matrix for all predictors that can be used in HomUHet.sim.

The usage of the package will be illustrated in the following sections.


# 2 HomUHet  

HomUHet can be used to identify and separates predictors with homogeneous or heterogeneous effect across multiple data sets through fitting penalized linear regression models in two steps. Applicable to Gaussian response variable and very high dimensional data where the number of predictors could be larger than the number of observations per data set. 

## 2.1 Input data for HomUHet

HomUHet<-function(data, solution_path_plot=FALSE)


<br>
**Arguments**

**data** is the data frame containing containing observations concatenated from all studies where the first column is the study label containing integers that indicate the study to which the observation belongs, the second column is the response variable and the following columns are the predictors including both genetic and non-genetic variables. All studies should use the same set of predictors. The predictors are also expected to be standardized such that the sample mean is 0 and sample variance is 1 for each predictor within each study. The response variable is limited to be a continuous variable. Below shows an example of the input data frame.

```{r}
library(HomUHet)
data(HomUHet_data)
HomUHet_data[1:5,1:4]# input data of 4 studies, same set of 500 predictors for each study.

dim(HomUHet_data)

unique(HomUHet_data$study_label) # study_label contains 4 different integers labeling the studies. 

x1=HomUHet_data[HomUHet_data$study_label==1,] # extracting observations from study 1
(colMeans(x1[,-(1:2)]))[1:5] # checking if the means are 0. showing the first 5 predictors here.
(apply(x1[,-(1:2)],2,sd))[1:5] # checking if the variances are 1. showing first 5 here.

```
In this sample data, the first column contains the study labels. For example, study_label=1 indicates that row 1 is an observation from study 1. The second column is the response variable, y. Starting from the third column are the predictors, which are standardized. 

**solution_path_plot** TRUE if outputting solution path plots is desired

```{r}
 HomUHet(data=HomUHet_data,solution_path_plot=TRUE)
```

## 2.2 Output values from HomUHet

<br>
**Values** the output is a list containing the following elements

**Homo** is a vector containing the names (if provided in the input data) or column numbers of identified homogeneous predictors.

**Heter** is a vector containing the names (if provided in the input data) or column numbers of identified heterogeneous predictors.

**coefficients** a matrix containing the estimated coefficients for the identified homogeneous or heterogeneous predictors. The estimates of a homogeneous predictor are identical across studies

```{r}
fit=HomUHet(data=HomUHet_data)
fit$Homo # the identified homogeneous predictors
fit$Heter # the identified heterogeneous predictors
fit$coefficients[1:2,] # the estimated coefficients
fit$coefficients[15:17,] # the estimated coefficients

```


# 3.1 Simulating multiple data sets 

HomUHet.sim<-function(Pred_type=c("Gaussian","SNP"), J, K, beta=NULL,
                      rho=0.5,sigma=2, level=c("l","m","e"),
                      nlower=50,nupper=300, allele_freq)

<br>
**Arguments**

**J** is the number of predictors. J should be at least 300 for this function to work.

**K** is the number of studies. choose between 4 and 10.

**level** represents the level of heterogeneity in the effects of predictors. "l" stands for low, "m" stands for medium, and "h" stands for high.

**beta**

**rho** should be a number between 0 and 1. This controls the degree of correlation between predictors

**sigma** should be a positive number. This controls the added noise to the simulated response variable

**nlower** sets the lower bound of the K sample sizes. The sample size for each study is picked from a uniform distribution with lower bound equal to nlower and upper bound equal to nupper

**nupper** sets the upper bound of the K sample sizes

**allele_freq**

<br>
**Values**

**x** is a matrix of predictors

**y** is a vector of response variable which is from gaussian distribution.

**study_label** is a vector of study labels taking on integers.


# 3.2 simulating coefficients

HomUHet.sim.beta<-function(J, K, homo_coef, heter_distr=c("Gaussian","Uniform"),
                           heter_coef_param)






       



